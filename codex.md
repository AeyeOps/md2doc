 # Code Decks

 This document provides an overview of the project structure, diagnoses issues with the GitHub Release workflow, and outlines a game plan for remediation.

 ## 1. Repository Structure
 - `.github/workflows/`
   - `ci.yml` - Continuous integration for testing and multi-OS builds
   - `release.yml` - Release workflow triggered on tag pushes and manual dispatch
 - `cmd/md2docx/` - Main Go CLI application entrypoint
 - `examples/` - Sample markdown inputs
 - `packaging/`
   - `homebrew/` - Homebrew formula
   - `windows/` - NSIS installer script
 - `KB/` - Knowledge base and workflow documentation
 - `CHANGELOG.md`, `README.md` - Project documentation
 - `go.mod`, `package-lock.json` - Dependency manifests

 ## 2. Current Release Workflow (`.github/workflows/release.yml`)
 1. Triggers:
    - `push` on tags matching `v*.*.*`
    - `workflow_dispatch` (manual)
 2. Steps:
    - Checkout code, setup Go
    - Build binaries for `linux_amd64`, `windows_amd64`, `darwin_amd64`
    - Package artifacts: `.deb`, `.tar.gz`, `.zip`, NSIS installer
    - Create GitHub Release with `actions/create-release@v1`
    - Upload assets with `actions/upload-release-asset@v1`

 ## 3. Issues Identified
 - **Trigger gaps**: creating a Release via GitHub UI does not fire `push`-tag events.
 - **Version parsing**: `VERSION=${GITHUB_REF#refs/tags/}` fails on manual dispatch (`GITHUB_REF` may default to branch).
 - **Manual dispatch** lacks an input parameter to specify the tag/version.
 - **NSIS substitution mismatch**: sed pattern targets `$VERSION` but the script uses `${VERSION}`.
 - **Action versions**: using older `actions/create-release@v1` and `upload-release-asset@v1` (consider updating).
 - **Asset naming inconsistencies**: slight divergence in naming patterns (`_linux_amd64` vs `_amd64`).

 ## 4. Proposed Game Plan
 1. **Enhance triggers**:
    - Add `release: [created]` event to support GitHub UIâ€“created releases.
 2. **Refactor version handling**:
    - Use `github.event.release.tag_name` for `release` events.
    - Introduce `workflow_dispatch` `inputs.version` and respect it.
    - Fallback to trimmed `github.ref_name` on tag pushes.
 3. **Fix NSIS placeholder**:
    - Align `installer.nsi` placeholders (`$VERSION` vs `${VERSION}`) or adjust sed regex.
 4. **Upgrade Actions**:
    - Move to `actions/create-release@v2+`, `actions/upload-release-asset@v2+`.
 5. **Standardize names**:
    - Choose a consistent asset naming scheme (e.g. `md2docx-${version}-${os}-${arch}${ext}`).
 6. **Add Go cache**:
    - Cache modules using `actions/cache@v3` for CI and Release builds.
 7. **Validation & Testing**:
    - Add a dry-run mode or separate test workflow to verify artifact generation.

 ## 5. Next Steps / Action Items
 - [ ] Draft updated `release.yml` with new triggers and inputs
 - [ ] Implement version-resolution logic and test locally
 - [ ] Adjust NSIS script and sed invocation
 - [ ] Update action versions and validate asset uploads
 - [ ] Run end-to-end test by pushing a `vX.Y.Z` tag and checking the release artifacts
 - [ ] Document changes in `README.md` or CONTRIBUTING.md

 _Generated by Codex CLI analysis_